# MSX Slot

## 概要

MSX では、Z80 がアクセスできるアドレス空間 $0000 ~ $FFFF を 16KB 毎の 4 つのページに分割している:

- $0000 - $3FFF : Page #0
- $4000 - $7FFF : Page #1
- $8000 - $BFFF : Page #2
- $C000 - $FFFF : Page #3

各ページにスロットと呼ばれる ROM / RAM の領域をマップすることで、データアクセスを行う。

スロットは 4 つ（ex: Slot #0 ~ Slot #3）があり、各スロットは 4 つ（ex: Slot #0-0 ~ Slot #0-3）まで拡張できる。

何処のスロットに何を割り当てるかについて概ね以下のルールになっている機種が多い:

- Slot #0: システム・スロット（BIOS）
- Slot #1: カートリッジ・スロット#1
- Slot #2: カートリッジ・スロット#2
- Slot #3: RAM スロット

電源投入すると Page 0 にメイン BIOS の先頭スロット（Slot #0 or Slot #0-0）が割り当てられ、アドレス $0000 からプログラムが動作し、最初に RAM スロットの探索と割り当てを行う。
その後、カートリッジ・スロットのチェックを行い、先頭 2 バイトに `A` `B` が格納されている場合、カートリッジが挿入されているものとしてカートリッジ・スロットのプログラムが実行され、カートリッジが挿入されていない場合は MSX-BASIC が起動する。

## ゲーム・カートリッジ

標準的な MSX のゲーム・カートリッジ（16KB or 32KB）を挿入して MSX を起動すると、以下のようなページレイアウトでゲームのプログラムが動作する。

- $0000 - $3FFF Page 0 : Slot #0-0 BIOS
- $4000 - $7FFF Page 1 : Slot #1-0 Cartridge #1 の先頭 16KB
- $8000 - $BFFF Page 2 : Slot #1-1 Cartridge #1 の 2 番目の 16KB
- $C000 - $FFFF Page 3 : Slot #3-0 RAM

> ゲームが動作中に BIOS を割り当てておくのは冗長だと思われるかもしれないが、その感覚は正しいと思われる。
> ただし、MSX の場合 16KB という広大なメモリが使える（SG-1000 やファミコンでは 2KB 程度しか自由に使えるメモリがない）ことを考えれば、Page 0 については BIOS を割り当てた冗長な状態であっても支障はなく、実際に Page 0 の領域を使っているプログラムは少ない。 _（例えば、$0038 に IM/1 の垂直同期割り込み処理を記述した RAM を Page 0 に割り当てれば、追加で 16KB の RAM 領域を確保できるが、それをやっている MSX のゲーム・プログラムを見たことがない）_

## メガロム

ゲーム・カートリッジに独自のバンクコントローラーなどを搭載したメガロムと呼ばれるものある。
メガロムには幾つか種類があるが大半は $4000 ~ $BFFF の領域を 8KB 単位に 4 分割して、WRITE アクセスでバンク切り替えできるもの（ASC8）が多い。
